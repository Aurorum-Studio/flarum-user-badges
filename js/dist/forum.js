module.exports=function(e){var t={};function a(r){if(t[r])return t[r].exports;var n=t[r]={i:r,l:!1,exports:{}};return e[r].call(n.exports,n,n.exports,a),n.l=!0,n.exports}return a.m=e,a.c=t,a.d=function(e,t,r){a.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:r})},a.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},a.t=function(e,t){if(1&t&&(e=a(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var r=Object.create(null);if(a.r(r),Object.defineProperty(r,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var n in e)a.d(r,n,function(t){return e[t]}.bind(null,n));return r},a.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return a.d(t,"a",t),t},a.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},a.p="",a(a.s=25)}([function(e,t){e.exports=flarum.core.compat.Model},function(e,t,a){"use strict";a.d(t,"a",(function(){return n}));var r=a(11);function n(e,t){e.prototype=Object.create(t.prototype),e.prototype.constructor=e,r(e,t)}},function(e,t){e.exports=flarum.core.compat["components/Button"]},function(e,t){e.exports=flarum.core.compat["components/Modal"]},function(e,t){e.exports=flarum.core.compat["utils/Stream"]},function(e,t){e.exports=flarum.core.compat["utils/ItemList"]},function(e,t){e.exports=flarum.core.compat["utils/mixin"]},function(e,t,a){"use strict";a.d(t,"a",(function(){return g}));var r=a(1),n=a(3),s=a.n(n),o=a(2),i=a.n(o),d=a(12),u=a.n(d),l=a(5),c=a.n(l),p=(a(18),a(8)),g=function(e){function t(){return e.apply(this,arguments)||this}Object(r.a)(t,e);var a=t.prototype;return a.oninit=function(t){e.prototype.oninit.call(this,t),this.loading=!1},a.className=function(){return"Modal--small"},a.title=function(){return app.translator.trans("v17development-flarum-badges.forum.badge_information")},a.content=function(){var e=this;return m("div",null,m("div",{className:"Modal-body"},this.data().toArray()),this.attrs.userBadgeData&&app.forum.attribute("canGiveBadge")&&m("div",{className:"Modal-footer"},m(i.a,{className:"Button Button--primary",onclick:function(){confirm(app.translator.trans("v17development-flarum-badges.forum.moderation.remove_badge_confirm"))&&(e.loading=!0,e.attrs.userBadgeData.delete().then((function(){return e.hide()})))},loading:this.loading},app.translator.trans("v17development-flarum-badges.forum.moderation.remove_badge"))))},a.data=function(){var e=this,t=new c.a;return t.add("name",m("div",{className:"BadgeModalListItem"},m("p",null,m("b",null,app.translator.trans("v17development-flarum-badges.forum.badge.name"),":")),m("p",null,this.attrs.badge.name()))),t.add("description",m("div",{className:"BadgeModalListItem"},m("p",null,m("b",null,app.translator.trans("v17development-flarum-badges.forum.badge.description"),":")),m("p",null,this.attrs.badge.description()))),this.attrs.userBadgeData&&(this.attrs.userBadgeData.description()||app.forum.attribute("canGiveBadge"))&&t.add("earning_reason",m("div",{className:"BadgeModalListItem"},m("p",null,m("b",null,app.translator.trans("v17development-flarum-badges.forum.badge.earning_reason"),":")),m("p",null,this.attrs.userBadgeData.description()?this.attrs.userBadgeData.description():m("i",null,app.translator.trans("v17development-flarum-badges.forum.badge.no_earning_reason"))),m("p",null,app.forum.attribute("canGiveBadge")&&m("a",{href:"#",onclick:function(t){t.preventDefault(),app.modal.show(p.a,{badge:e.attrs.userBadgeData})}},app.translator.trans("v17development-flarum-badges.forum.badge.update_earning_reason"))))),this.attrs.userBadgeData&&t.add("earned_date",m("div",{className:"BadgeModalListItem"},m("p",null,m("b",null,app.translator.trans("v17development-flarum-badges.forum.badge.earned_on"),":")),m("p",null,u()(this.attrs.userBadgeData.assignedAt())))),this.attrs.userBadgeData&&t.add("category",m("div",{className:"BadgeModalListItem"},m("p",null,m("b",null,app.translator.trans("v17development-flarum-badges.forum.badge.category"),":")),m("p",null,this.attrs.badge.category()&&this.attrs.badge.category().name(),!this.attrs.badge.category()&&app.translator.trans("v17development-flarum-badges.forum.uncategorized")))),this.attrs.badge&&this.attrs.badge.earnedAmount()&&t.add("earned_amount",m("div",{className:"BadgeModalListItem"},m("p",null,app.translator.transChoice("v17development-flarum-badges.forum.badge.earned_count",this.attrs.badge.earnedAmount(),{count:this.attrs.badge.earnedAmount()})))),t},t}(s.a)},function(e,t,a){"use strict";a.d(t,"a",(function(){return g}));var r=a(1),n=a(3),s=a.n(n),o=a(2),i=a.n(o),d=a(5),u=a.n(d),l=(a(19),a(4)),c=a.n(l),p=a(7),g=function(e){function t(){return e.apply(this,arguments)||this}Object(r.a)(t,e);var a=t.prototype;return a.oninit=function(t){var a=this;e.prototype.oninit.call(this,t),this.selectedBadge=this.attrs.badge?this.attrs.badge.badge():null,this.user=this.attrs.badge?this.attrs.badge.user():this.attrs.user,this.userHasBadge=!1,this.badge=this.attrs.badge?this.attrs.badge:app.store.createRecord("userBadges"),this.description=c()(this.badge.description()),this.categories={},this.uncategorizedBadges=[],this.loading=!1,this.attrs.badge?this.availableBadges[this.selectedBadge.id()]=this.selectedBadge.name():(this.loading=!0,app.store.find("badges",{include:"category"}).then((function(e){e.forEach((function(e){if(e.category()){var t=e.category();a.categories[t.id()]?a.categories[t.id()].badges.push(e):a.categories[t.id()]={category:t,badges:[e]}}else a.uncategorizedBadges.push(e)})),a.loading=!1,m.redraw()})))},a.className=function(){return"Modal--small BadgeModal"},a.title=function(){return app.translator.trans("v17development-flarum-badges.forum."+(this.badge.exists?"update":"give")+"_badge")},a.content=function(){return m("div",null,m("div",{className:"Modal-body"},m("div",{className:"Form"},this.fields().toArray())),m("div",{className:"Modal-footer"},m(i.a,{className:"Button Button--primary",type:"submit",loading:this.loading,disabled:this.userHasBadge},app.translator.trans("core.forum.composer_edit.submit_button"))))},a.fields=function(){var e=this,t=new u.a;return t.add("badge",m("div",{className:"BadgeModalListItem"},m("p",null,m("b",null,app.translator.trans("v17development-flarum-badges.forum.badge.badge"))),m("div",{className:"Select"},m("select",{value:this.selectedBadge?this.selectedBadge.id():"empty",disabled:!!this.attrs.badge,onchange:function(t){"empty"!==t.target.value&&(e.selectedBadge=app.store.getById("badges",t.target.value),e.checkUserHasBadge(e.selectedBadge))},className:"Select-input FormControl"},m("option",{value:"empty"},app.translator.trans("v17development-flarum-badges.forum.select_badge")),!this.attrs.badge&&Object.values(this.categories).map((function(e){var t=e.category,a=e.badges;return m("optgroup",{label:t.name()},a.map((function(e){return m("option",{value:e.id()},e.name())})))})),!this.attrs.badge&&this.uncategorizedBadges.length>=1&&m("optgroup",{label:app.translator.trans("v17development-flarum-badges.forum.uncategorized")},this.uncategorizedBadges.map((function(e){return m("option",{value:e.id()},e.name())}))),!!this.attrs.badge&&m("option",{value:this.selectedBadge.id()},this.selectedBadge.name())),m("i",{class:"icon fas fa-caret-down Select-caret"})),this.userHasBadge&&m("p",{className:"UserHasBadge"},app.translator.trans("v17development-flarum-badges.forum.user_has_badge"))),30),t.add("badge_description",m("div",{className:"BadgeModalListItem"},m("p",null,m("b",null,app.translator.trans("v17development-flarum-badges.forum.badge.description"),":")),m("p",null,this.selectedBadge?this.selectedBadge.description():app.translator.trans("v17development-flarum-badges.forum.select_badge"))),30),t.add("description",m("div",{className:"BadgeModalListItem"},m("p",null,m("b",null,app.translator.trans("v17development-flarum-badges.forum.badge.earning_reason"))),m("textarea",{className:"FormControl",placeholder:app.translator.trans("v17development-flarum-badges.forum.badge.earning_reason"),bidi:this.description})),30),t},a.checkUserHasBadge=function(e){var t=!1;this.user.userBadges().map((function(a){a.badge()==e&&(t=!0)})),this.userHasBadge=t,m.redraw()},a.onsubmit=function(e){var t=this;e.preventDefault(),this.loading=!0,this.badge.save({description:this.description(),relationships:this.attrs.badge?{}:{badge:this.selectedBadge,user:this.user}}).then((function(){t.attrs.badge?app.modal.show(p.a,{badge:t.attrs.badge.badge(),userBadgeData:t.attrs.badge}):t.hide(),m.redraw()}),(function(e){t.loading=!1,t.handleErrors(e)}))},t}(s.a)},function(e,t){e.exports=flarum.core.compat["common/Component"]},function(e,t,a){"use strict";a.d(t,"a",(function(){return d}));var r=a(1),n=a(0),s=a.n(n),o=a(6),i=a.n(o),d=(a(7),function(e){function t(){return e.apply(this,arguments)||this}return Object(r.a)(t,e),t.prototype.apiEndpoint=function(){return"/badges"+(this.exists?"/"+this.data.id:"")},t}(i()(s.a,{name:s.a.attribute("name"),icon:s.a.attribute("icon"),order:s.a.attribute("order"),image:s.a.attribute("image"),description:s.a.attribute("description"),isVisible:s.a.attribute("isVisible"),createdAt:s.a.attribute("createdAt"),earnedAmount:s.a.attribute("earnedAmount"),category:s.a.hasOne("category")})))},function(e,t){function a(t,r){return e.exports=a=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e},e.exports.default=e.exports,e.exports.__esModule=!0,a(t,r)}e.exports=a,e.exports.default=e.exports,e.exports.__esModule=!0},function(e,t){e.exports=flarum.core.compat["helpers/fullTime"]},function(e,t,a){"use strict";a.d(t,"a",(function(){return i}));var r=a(1),n=a(0),s=a.n(n),o=a(6),i=function(e){function t(){return e.apply(this,arguments)||this}return Object(r.a)(t,e),t.prototype.apiEndpoint=function(){return"/badge_categories"+(this.exists?"/"+this.data.id:"")},t}(a.n(o)()(s.a,{name:s.a.attribute("name"),order:s.a.attribute("order"),description:s.a.attribute("description"),isEnabled:s.a.attribute("isEnabled"),createdAt:s.a.attribute("createdAt"),users:s.a.hasMany("users"),badges:s.a.hasMany("badges")}))},function(e,t){e.exports=flarum.core.compat["components/LoadingIndicator"]},,function(e,t){e.exports=flarum.core.compat["components/UserPage"]},function(e,t){e.exports=flarum.core.compat["components/Page"]},function(e,t){e.exports=flarum.core.compat["components/Link"]},function(e,t){e.exports=flarum.core.compat["components/Select"]},function(e,t){e.exports=flarum.core.compat.extend},function(e,t){e.exports=flarum.core.compat["models/User"]},function(e,t){e.exports=flarum.core.compat["utils/UserControls"]},function(e,t){e.exports=flarum.core.compat["components/LinkButton"]},,function(e,t,a){"use strict";a.r(t);var r=a(20),n=a(0),s=a.n(n),o=a(21),i=a.n(o),d=a(16),u=a.n(d),l=a(22),c=a.n(l),p=a(23),g=a.n(p),f=a(2),b=a.n(f),h=a(10),v=a(13),y=a(1),B=a(6),_=function(e){function t(){return e.apply(this,arguments)||this}return Object(y.a)(t,e),t.prototype.apiEndpoint=function(){return"/user_badges"+(this.exists?"/"+this.data.id:"")},t}(a.n(B)()(s.a,{user:s.a.hasOne("user"),badge:s.a.hasOne("badge"),description:s.a.attribute("description"),isPrimary:s.a.attribute("isPrimary"),assignedAt:s.a.attribute("assignedAt")})),x=a(14),N=a.n(x),O=a(9),M=a.n(O),j=a(7),D=function(e){function t(){return e.apply(this,arguments)||this}Object(y.a)(t,e);var a=t.prototype;return a.view=function(){var e=this;return this.attrs.badge.isVisible()?m("span",{className:"UserBadge",title:""+(this.attrs.badge.description()?this.attrs.badge.description():""),onclick:function(){return app.modal.show(j.a,{badge:e.attrs.badge,userBadgeData:e.attrs.userBadgeData})}},m("i",{className:this.attrs.badge.icon()})," ",this.attrs.badge.name()):null},a.oncreate=function(t){e.prototype.oncreate.call(this,t),this.$().tooltip()},t}(M.a),w=function(e){function t(){return e.apply(this,arguments)||this}return Object(y.a)(t,e),t.prototype.view=function(){var e={},t=[];return this.attrs.user.userBadges().map((function(a){if(!a)return null;if(a.badge().category()){var r=a.badge().category();e[r.id()]?e[r.id()].badges.push(a):e[r.id()]={category:r,badges:[a]}}else t.push(a)})),m("div",{className:"UserBadges"},0===Object.keys(e).length&&m("div",{className:"Placeholder"},m("p",null,app.translator.trans("v17development-flarum-badges.forum.user_no_badges"))),Object.keys(e).length>=1&&Object.keys(e).sort((function(t,a){return e[t].category.order()-e[a].category.order()})).map((function(t){var a=e[t].category,r=e[t].badges;return a.isEnabled()?m("div",{className:"UserBadgesCategory"},m("h3",null,a.name()),a.description()&&m("p",null,a.description()),r.sort((function(e,t){return e.badge().order()-t.badge().order()})).map((function(e){return m(D,{badge:e.badge(),userBadgeData:e})}))):null})),t.length>=1&&m("div",{className:"UserBadgesCategory"},m("h3",null,app.translator.trans("v17development-flarum-badges.forum.uncategorized")),t.sort((function(e,t){return e.badge().order()-t.badge().order()})).map((function(e){return m(D,{badge:e.badge(),userBadgeData:e})}))))},t}(M.a),A=function(e){function t(){return e.apply(this,arguments)||this}Object(y.a)(t,e);var a=t.prototype;return a.oninit=function(t){e.prototype.oninit.call(this,t),this.user=null,this.loading=!0,this.loadUser(m.route.param("username"))},a.content=function(){return!this.user||this.loading?m(N.a,{size:46}):w.component({user:this.user})},a.show=function(t){var a=this;e.prototype.show.call(this,t),this.user=t,app.store.find("users",t.id(),{include:"userBadges,userBadges.badge,userBadges.badge.category"}).then((function(){a.loading=!1,m.redraw()}))},t}(u.a),I=a(17),L=a.n(I),P=(L.a,L.a,a(8));app.initializers.add("v17development-flarum-badges",(function(e){e.store.models.badges=h.a,e.store.models.badgeCategories=v.a,e.store.models.userBadges=_,i.a.prototype.userBadges=s.a.hasMany("userBadges"),i.a.prototype.userPrimaryBadge=s.a.hasOne("userPrimaryBadge"),e.routes["user.badges"]={path:"/u/:username/badges",component:A},Object(r.extend)(u.a.prototype,"navItems",(function(t){t.add("badges",g.a.component({href:e.route("user.badges",{username:this.user.username()}),name:"badges",icon:"fas fa-user-tag"},[e.translator.trans("v17development-flarum-badges.forum.badge.badges"),m("span",{className:"Button-badge"},this.user.userBadges().length)]),90)})),Object(r.extend)(c.a,"moderationControls",(function(t,a){e.forum.attribute("canGiveBadge")&&t.add("test",m(b.a,{icon:"fas fa-user-tag",onclick:function(){return e.modal.show(P.a,{user:a})}},e.translator.trans("v17development-flarum-badges.forum.give_badge")))}))}))}]);
//# sourceMappingURL=forum.js.map