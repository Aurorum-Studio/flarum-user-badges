(()=>{var e={n:t=>{var a=t&&t.__esModule?()=>t.default:()=>t;return e.d(a,{a}),a},d:(t,a)=>{for(var r in a)e.o(a,r)&&!e.o(t,r)&&Object.defineProperty(t,r,{enumerable:!0,get:a[r]})},o:(e,t)=>Object.prototype.hasOwnProperty.call(e,t),r:e=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})}},t={};(()=>{"use strict";e.r(t);const a=flarum.core.compat["common/app"];e.n(a)().initializers.add("v17development/flarum-user-badges",(function(){}));const r=flarum.core.compat.extend,s=flarum.core.compat.Model;var n=e.n(s);const o=flarum.core.compat["models/User"];var i=e.n(o);const d=flarum.core.compat["components/UserPage"];var l=e.n(d);const u=flarum.core.compat["utils/UserControls"];var c=e.n(u);const p=flarum.core.compat["components/LinkButton"];var g=e.n(p);const b=flarum.core.compat["components/Button"];var f=e.n(b);function h(e,t){return h=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e},h(e,t)}function v(e,t){e.prototype=Object.create(t.prototype),e.prototype.constructor=e,h(e,t)}const y=flarum.core.compat["utils/mixin"];var B=e.n(y);const N=flarum.core.compat["components/Modal"];var _=e.n(N);const I=flarum.core.compat["helpers/fullTime"];var w=e.n(I);const C=flarum.core.compat["utils/ItemList"];var x=e.n(C);flarum.core.compat["components/Select"];const k=flarum.core.compat["utils/Stream"];var L=e.n(k),P=function(e){function t(){return e.apply(this,arguments)||this}v(t,e);var a=t.prototype;return a.oninit=function(t){var a=this;e.prototype.oninit.call(this,t),this.selectedBadge=this.attrs.badge?this.attrs.badge.badge():null,this.user=this.attrs.badge?this.attrs.badge.user():this.attrs.user,this.userHasBadge=!1,this.badge=this.attrs.badge?this.attrs.badge:app.store.createRecord("userBadges"),this.description=L()(this.badge.description()),this.categories={},this.uncategorizedBadges=[],this.loading=!1,this.attrs.badge||(this.loading=!0,app.store.find("badges",{include:"category"}).then((function(e){e.forEach((function(e){if(e.category()){var t=e.category();a.categories[t.id()]?a.categories[t.id()].badges.push(e):a.categories[t.id()]={category:t,badges:[e]}}else a.uncategorizedBadges.push(e)})),a.loading=!1,m.redraw()})))},a.className=function(){return"Modal--small BadgeModal"},a.title=function(){return app.translator.trans("v17development-flarum-badges.forum."+(this.badge.exists?"update":"give")+"_badge")},a.content=function(){return m("div",null,m("div",{className:"Modal-body"},m("div",{className:"Form"},this.fields().toArray())),m("div",{className:"Modal-footer"},m(f(),{className:"Button Button--primary",type:"submit",loading:this.loading,disabled:this.userHasBadge},app.translator.trans("core.forum.composer_edit.submit_button"))))},a.fields=function(){var e=this,t=new(x());return t.add("badge",m("div",{className:"BadgeModalListItem"},m("p",null,m("b",null,app.translator.trans("v17development-flarum-badges.forum.badge.badge"))),m("div",{className:"Select"},m("select",{value:this.selectedBadge?this.selectedBadge.id():"empty",disabled:!!this.attrs.badge,onchange:function(t){"empty"!==t.target.value&&(e.selectedBadge=app.store.getById("badges",t.target.value),e.checkUserHasBadge(e.selectedBadge))},className:"Select-input FormControl"},m("option",{value:"empty"},app.translator.trans("v17development-flarum-badges.forum.select_badge")),!this.attrs.badge&&Object.values(this.categories).map((function(e){var t=e.category,a=e.badges;return m("optgroup",{label:t.name()},a.map((function(e){return m("option",{value:e.id()},e.name())})))})),!this.attrs.badge&&this.uncategorizedBadges.length>=1&&m("optgroup",{label:app.translator.trans("v17development-flarum-badges.forum.uncategorized")},this.uncategorizedBadges.map((function(e){return m("option",{value:e.id()},e.name())}))),!!this.attrs.badge&&m("option",{value:this.selectedBadge.id()},this.selectedBadge.name())),m("i",{class:"icon fas fa-caret-down Select-caret"})),this.userHasBadge&&m("p",{className:"UserHasBadge"},app.translator.trans("v17development-flarum-badges.forum.user_has_badge"))),30),t.add("badge_description",m("div",{className:"BadgeModalListItem"},m("p",null,m("b",null,app.translator.trans("v17development-flarum-badges.forum.badge.description"),":")),m("p",null,this.selectedBadge?this.selectedBadge.description():app.translator.trans("v17development-flarum-badges.forum.select_badge"))),30),t.add("description",m("div",{className:"BadgeModalListItem"},m("p",null,m("b",null,app.translator.trans("v17development-flarum-badges.forum.badge.earning_reason"))),m("textarea",{className:"FormControl",placeholder:app.translator.trans("v17development-flarum-badges.forum.badge.earning_reason"),bidi:this.description})),30),t},a.checkUserHasBadge=function(e){var t=!1;this.user.userBadges().map((function(a){a.badge()==e&&(t=!0)})),this.userHasBadge=t,m.redraw()},a.onsubmit=function(e){var t=this;e.preventDefault(),this.loading=!0,this.badge.save({description:this.description(),relationships:this.attrs.badge?{}:{badge:this.selectedBadge,user:this.user}}).then((function(){t.attrs.badge?app.modal.show(M,{badge:t.attrs.badge.badge(),userBadgeData:t.attrs.badge}):t.hide(),m.redraw()}),(function(e){t.loading=!1,t.handleErrors(e)}))},t}(_()),M=function(e){function t(){return e.apply(this,arguments)||this}v(t,e);var a=t.prototype;return a.oninit=function(t){e.prototype.oninit.call(this,t),this.loading=!1},a.className=function(){return"Modal--small"},a.title=function(){return app.translator.trans("v17development-flarum-badges.forum.badge_information")},a.content=function(){var e=this;return m("div",null,m("div",{className:"Modal-body"},this.data().toArray()),m("div",{className:"Modal-footer"},m(g(),{href:app.route("badges.item",{id:this.attrs.badge.id()}),className:"Button",style:{margin:"0 10px"}},app.translator.trans("v17development-flarum-badges.forum.badge.badge_details")),this.attrs.userBadgeData&&app.forum.attribute("canGiveBadge")&&m(f(),{className:"Button Button--primary",onclick:function(){confirm(app.translator.trans("v17development-flarum-badges.forum.moderation.remove_badge_confirm"))&&(e.loading=!0,e.attrs.userBadgeData.delete().then((function(){return e.hide()})))},loading:this.loading},app.translator.trans("v17development-flarum-badges.forum.moderation.remove_badge"))))},a.data=function(){var e=this,t=new(x());return t.add("name",m("div",{className:"BadgeModalListItem"},m("p",null,m("b",null,app.translator.trans("v17development-flarum-badges.forum.badge.name"),":")),m("p",null,this.attrs.badge.name()))),t.add("description",m("div",{className:"BadgeModalListItem"},m("p",null,m("b",null,app.translator.trans("v17development-flarum-badges.forum.badge.description"),":")),m("p",null,this.attrs.badge.description()))),this.attrs.userBadgeData&&(this.attrs.userBadgeData.description()||app.forum.attribute("canGiveBadge"))&&t.add("earning_reason",m("div",{className:"BadgeModalListItem"},m("p",null,m("b",null,app.translator.trans("v17development-flarum-badges.forum.badge.earning_reason"),":")),m("p",null,this.attrs.userBadgeData.description()?this.attrs.userBadgeData.description():m("i",null,app.translator.trans("v17development-flarum-badges.forum.badge.no_earning_reason"))),m("p",null,app.forum.attribute("canGiveBadge")&&m("a",{href:"#",onclick:function(t){t.preventDefault(),app.modal.show(P,{badge:e.attrs.userBadgeData})}},app.translator.trans("v17development-flarum-badges.forum.badge.update_earning_reason"))))),this.attrs.userBadgeData&&t.add("earned_date",m("div",{className:"BadgeModalListItem"},m("p",null,m("b",null,app.translator.trans("v17development-flarum-badges.forum.badge.earned_on"),":")),m("p",null,w()(this.attrs.userBadgeData.assignedAt())))),this.attrs.userBadgeData&&t.add("category",m("div",{className:"BadgeModalListItem"},m("p",null,m("b",null,app.translator.trans("v17development-flarum-badges.forum.badge.category"),":")),m("p",null,this.attrs.badge.category()&&this.attrs.badge.category().name(),!this.attrs.badge.category()&&app.translator.trans("v17development-flarum-badges.forum.uncategorized")))),this.attrs.badge&&this.attrs.badge.earnedAmount()&&t.add("earned_amount",m("div",{className:"BadgeModalListItem"},m("p",null,app.translator.trans("v17development-flarum-badges.forum.badge.earned_count",{count:this.attrs.badge.earnedAmount()})))),t},t}(_()),O=function(e){function t(){return e.apply(this,arguments)||this}return v(t,e),t.prototype.apiEndpoint=function(){return"/badges"+(this.exists?"/"+this.data.id:"")},t}(B()(n(),{name:n().attribute("name"),icon:n().attribute("icon"),order:n().attribute("order"),image:n().attribute("image"),description:n().attribute("description"),isVisible:n().attribute("isVisible"),createdAt:n().attribute("createdAt"),earnedAmount:n().attribute("earnedAmount"),category:n().hasOne("category"),backgroundColor:n().attribute("backgroundColor"),iconColor:n().attribute("iconColor"),labelColor:n().attribute("labelColor")})),U=function(e){function t(){return e.apply(this,arguments)||this}return v(t,e),t.prototype.apiEndpoint=function(){return"/badge_categories"+(this.exists?"/"+this.data.id:"")},t}(B()(n(),{name:n().attribute("name"),order:n().attribute("order"),description:n().attribute("description"),isEnabled:n().attribute("isEnabled"),createdAt:n().attribute("createdAt"),isTable:n().attribute("isTable"),users:n().hasMany("users"),badges:n().hasMany("badges")})),A=function(e){function t(){return e.apply(this,arguments)||this}return v(t,e),t.prototype.apiEndpoint=function(){return"/user_badges"+(this.exists?"/"+this.data.id:"")},t}(B()(n(),{user:n().hasOne("user"),badge:n().hasOne("badge"),description:n().attribute("description"),isPrimary:n().attribute("isPrimary"),assignedAt:n().attribute("assignedAt")}));const D=flarum.core.compat["components/LoadingIndicator"];var T=e.n(D);const S=flarum.core.compat["common/Component"];var z=e.n(S);const j=flarum.core.compat["common/components/Tooltip"];var E=e.n(j),V=function(e){function t(){return e.apply(this,arguments)||this}v(t,e);var a=t.prototype;return a.oninit=function(t){e.prototype.oninit.call(this,t),this.tooltip=!1!==this.attrs.tooltip,this.forceVisibility=!0===this.attrs.forceVisibility},a.view=function(){return this.attrs.badge.isVisible()||this.forceVisibility?!1===this.tooltip?this.badge():m(E(),{text:""+(this.attrs.badge.description()?this.attrs.badge.description():"")},this.badge()):null},a.badge=function(){var e=this,t=!this.attrs.badge.isVisible()&&this.forceVisibility;return this.attrs.badge.image()?m("img",{src:this.attrs.badge.image(),className:"UserBadgeImage",onclick:function(){e.attrs.onclick&&e.attrs.onclick()},style:{opacity:t?.5:void 0}}):m("span",{className:"UserBadge UserBadge-"+this.attrs.badge.id(),onclick:function(){e.attrs.onclick&&e.attrs.onclick()},style:{backgroundColor:this.attrs.badge.backgroundColor(),color:this.attrs.badge.labelColor(),borderColor:this.attrs.badge.backgroundColor(),opacity:t?.5:void 0}},m("i",{className:this.attrs.badge.icon(),style:{color:this.attrs.badge.iconColor()}})," ",this.attrs.badge.name())},t}(z()),H=function(e){function t(){return e.apply(this,arguments)||this}return v(t,e),t.prototype.view=function(){var e={},t=[];return this.attrs.user.userBadges().map((function(a){if(!a)return null;if(a.badge().category()){var r=a.badge().category();e[r.id()]?e[r.id()].badges.push(a):e[r.id()]={category:r,badges:[a]}}else t.push(a)})),m("div",{className:"UserBadges"},0===Object.keys(e).length&&m("div",{className:"Placeholder"},m("p",null,app.translator.trans("v17development-flarum-badges.forum.user_no_badges"))),Object.keys(e).length>=1&&Object.keys(e).sort((function(t,a){return e[t].category.order()-e[a].category.order()})).map((function(t){var a=e[t].category,r=e[t].badges;return a.isEnabled()?m("div",{className:"UserBadgesCategory"},m("h3",null,a.name()),a.description()&&m("p",null,a.description()),r.sort((function(e,t){return e.badge().order()-t.badge().order()})).map((function(e){return m(V,{badge:e.badge(),onclick:function(){return app.modal.show(M,{badge:e.badge(),userBadgeData:e})}})}))):null})),t.length>=1&&m("div",{className:"UserBadgesCategory"},m("h3",null,app.translator.trans("v17development-flarum-badges.forum.uncategorized")),t.sort((function(e,t){return e.badge().order()-t.badge().order()})).map((function(e){return m(V,{badge:e.badge(),onclick:function(){return app.modal.show(M,{badge:e.badge(),userBadgeData:e})}})}))))},t}(z()),G=function(e){function t(){return e.apply(this,arguments)||this}v(t,e);var a=t.prototype;return a.oninit=function(t){e.prototype.oninit.call(this,t),this.user=null,this.loading=!0,this.loadUser(m.route.param("username"))},a.content=function(){return!this.user||this.loading?m(T(),{size:46}):H.component({user:this.user})},a.show=function(t){var a=this;e.prototype.show.call(this,t),this.user=t,app.store.find("users",t.id(),{include:"userBadges,userBadges.badge,userBadges.badge.category"}).then((function(){a.loading=!1,m.redraw()}))},t}(l());const R=flarum.core.compat["components/Page"];var F=e.n(R);const q=flarum.core.compat["components/IndexPage"];var J=e.n(q);const K=flarum.core.compat["common/helpers/listItems"];var Q=e.n(K);const W=flarum.core.compat["components/Link"];var X=e.n(W),Y=function(e){function t(){return e.apply(this,arguments)||this}return v(t,e),t.prototype.view=function(){if(!this.attrs.badges)return null;var e=this.attrs.badges;return m("table",{width:"100%",className:"BadgeTable"},m("thead",null,m("tr",null,m("th",{scope:"col"},app.translator.trans("v17development-flarum-badges.forum.badge.badges")),m("th",{scope:"col"},app.translator.trans("v17development-flarum-badges.forum.badge.description")))),m("tbody",null,e.map((function(e){return m("tr",null,m("td",null,m(X(),{href:app.route("badges.item",{id:e.id()})},m(V,{badge:e,tooltip:!1}))),m("td",null,e.description(),m("div",{className:"BadgeTableRewarded"},app.translator.trans("v17development-flarum-badges.forum.badge.earned_count",{count:e.earnedAmount()}))))}))))},t}(z()),Z=function(e){function t(){return e.apply(this,arguments)||this}return v(t,e),t.prototype.view=function(){if(!this.attrs.badges)return null;var e=this.attrs.badges;return m("ul",{className:"BadgeCategoryList"},e.map((function(e){return m("li",null,m(X(),{href:app.route("badges.item",{id:e.id()}),className:"BadgeContainer"},m("div",{className:"BadgeContainerInfo"},m(V,{badge:e,tooltip:!1}),m("p",{className:"BadgeDescription"},e.description()),m("p",null,app.translator.trans("v17development-flarum-badges.forum.badge.earned_count",{count:e.earnedAmount()})))))})))},t}(z()),$=function(e){function t(){return e.apply(this,arguments)||this}v(t,e);var a=t.prototype;return a.oninit=function(t){var a=this;e.prototype.oninit.call(this,t),this.bodyClass="App--index",this.loading=!0,app.history.push("badgeOverviewPage"),app.setTitle(app.translator.trans("v17development-flarum-badges.forum.badge.badges")),app.store.find("badge_categories").then((function(){a.loading=!1,m.redraw()}))},a.view=function(){var e=app.store.all("badgeCategories").sort((function(e,t){return e.order()-t.order()}));return m("div",{className:"IndexPage"},J().prototype.hero(),m("div",{className:"container"},m("div",{className:"sideNavContainer"},m("nav",{className:"IndexPage-nav sideNav"},m("ul",null,Q()(J().prototype.sidebarItems().toArray()))),m("div",{className:"IndexPage-results sideNavOffset"},m("h2",{className:"BadgeOverviewTitle"},app.translator.trans("v17development-flarum-badges.forum.badge.badges")),this.loading&&m(T(),{size:"large"}),!this.loading&&e.map((function(e){var t=e.badges().sort((function(e,t){return e.order()-t.order()}));return m("div",{className:"BadgeCategory"},m("h3",null,e.name()),e.description()&&m("p",null,e.description()),e.isTable()&&m(Y,{badges:t}),!e.isTable()&&m(Z,{badges:t}))}))))))},t}(F());const ee=flarum.core.compat["helpers/avatar"];var te=e.n(ee);const ae=flarum.core.compat["helpers/humanTime"];var re=e.n(ae),se=function(e){function t(){return e.apply(this,arguments)||this}v(t,e);var a=t.prototype;return a.oninit=function(t){e.prototype.oninit.call(this,t),this.attrs.state.refreshParams({filter:{badge:this.attrs.badgeId},sort:"-assignedAt"})},a.view=function(){var e=this.attrs.state,t=null;return e.isInitialLoading()||e.isLoadingNext()?t=T().component({size:"large"}):e.hasNext()&&(t=f().component({className:"Button",icon:"fas fa-chevron-down",onclick:e.loadNext.bind(e)},app.translator.trans("core.forum.discussion_list.load_more_button"))),e.isInitialLoading()&&e.isEmpty()?m(T(),null):e.isEmpty()?m("div",{className:"BadgeUserList-empty"},app.translator.trans("v17development-flarum-badges.forum.no_received")):m("div",null,m("ul",{className:"BadgeUserList"},e.getPages().map((function(e){return e.items.map((function(e){return m("li",null,m(X(),{href:app.route("user.badges",{username:e.user().username()}),className:"BadgeUserList-user"},te()(e.user()),m("div",{className:"BadgeUserList-userinfo"},m("h4",null,e.user().displayName()),m("p",null,app.translator.trans("v17development-flarum-badges.forum.badge.received_on",{date:re()(e.assignedAt())})))))}))}))),t&&m("div",{className:"SupportSearchList-loadMore"},t))},t}(z()),ne=function(e){function t(){return e.apply(this,arguments)||this}v(t,e);var a=t.prototype;return a.oninit=function(t){var a=this;e.prototype.oninit.call(this,t),this.bodyClass="App--index";var r=app.store.getById("badges",m.route.param("id"));this.loading=!r,r?(app.history.push("badgeItemPage",r.name()),this.setTitle(r)):app.store.find("badges/"+m.route.param("id")).then((function(e){a.loading=!1,app.history.push("badgeItemPage",e.name()),a.setTitle(e),m.redraw()}))},a.setTitle=function(e){app.setTitle(e.name()+" - "+app.translator.trans("v17development-flarum-badges.forum.badge.badges"))},a.view=function(){var e=app.store.getById("badges",m.route.param("id"));return m("div",{className:"IndexPage"},J().prototype.hero(),m("div",{className:"container"},m("div",{className:"sideNavContainer"},m("nav",{className:"IndexPage-nav sideNav"},m("ul",null,Q()(J().prototype.sidebarItems().toArray()))),m("div",{className:"IndexPage-results sideNavOffset"},m(g(),{href:app.route("badges"),icon:"fas fa-chevron-left",className:"Button BadgesOverviewButton"},app.translator.trans("v17development-flarum-badges.forum.badge.badges")),this.loading&&m(T(),{size:"large"}),!this.loading&&m("div",{className:"BadgeUserListInfo"},m("i",{className:e.icon()}),m("div",{className:"BadgeUserListInfo-meta"},m("h3",null,e.name()),m("p",null,e.description()))),e&&m("h3",null,app.translator.trans("v17development-flarum-badges.forum.badge.earned_by_count",{count:e.earnedAmount()})),!this.loading&&app.forum.attribute("canViewDetailedBadgeUsers")&&m(se,{state:app.userBadgeListState,badgeId:e.id()})))))},t}(F());function oe(){(0,r.extend)(J().prototype,"navItems",(function(e){return e.add("badges",m(g(),{icon:"fas fa-id-badge",href:app.route("badges")},app.translator.trans("v17development-flarum-badges.forum.badge.badges")),15),e}))}function ie(e,t){for(var a=0;a<t.length;a++){var r=t[a];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}const de=flarum.core.compat["common/states/PaginatedListState"];var le=function(e){function t(t,a){return void 0===a&&(a=1),e.call(this,t,a,18)||this}var a,r;return v(t,e),a=t,(r=[{key:"type",get:function(){return"user_badges"}}])&&ie(a.prototype,r),t}(e.n(de)());const ue=flarum.core.compat["forum/components/Notification"];var me=function(e){function t(){return e.apply(this,arguments)||this}v(t,e);var a=t.prototype;return a.icon=function(){return""},a.href=function(){return app.route("user.badges",{username:app.session.user.username()})},a.content=function(){return app.translator.trans("v17development-flarum-badges.forum.notification.title")},a.excerpt=function(){var e=this.attrs.notification.subject();return m("div",null,m("i",{className:"icon "+e.badge().icon()}),e.badge().name())},t}(e.n(ue)());const ce=flarum.core.compat["forum/components/NotificationGrid"];var pe=e.n(ce);const ge=flarum.core.compat["forum/app"];var be=e.n(ge);const fe=flarum.core.compat["common/extend"],he=flarum.core.compat["forum/components/UserCard"];var ve=e.n(he);app.initializers.add("v17development-flarum-badges",(function(e){e.store.models.badges=O,e.store.models.badgeCategories=U,e.store.models.userBadges=A,i().prototype.userBadges=n().hasMany("userBadges"),i().prototype.userPrimaryBadge=n().hasOne("userPrimaryBadge"),e.routes["user.badges"]={path:"/u/:username/badges",component:G},e.routes.badges={path:"/badges",component:$},e.routes["badges.item"]={path:"/badges/:id",component:ne},oe(),e.userBadgeListState=new le({}),e.notificationComponents.badgeReceived=me,(0,r.extend)(pe().prototype,"notificationTypes",(function(t){t.add("badgeReceived",{name:"badgeReceived",icon:"fas fa-user-tag",label:e.translator.trans("v17development-flarum-badges.forum.notification.settings")})})),(0,r.extend)(l().prototype,"navItems",(function(t){t.add("badges",g().component({href:e.route("user.badges",{username:this.user.username()}),name:"badges",icon:"fas fa-user-tag"},[e.translator.trans("v17development-flarum-badges.forum.badge.badges"),m("span",{className:"Button-badge"},this.user.userBadges().length)]),90)})),(0,r.extend)(c(),"moderationControls",(function(t,a){e.forum.attribute("canGiveBadge")&&t.add("test",m(f(),{icon:"fas fa-user-tag",onclick:function(){return e.modal.show(P,{user:a})}},e.translator.trans("v17development-flarum-badges.forum.give_badge")))})),(0,fe.extend)(ve().prototype,"infoItems",(function(e){var t=this.attrs.user.userBadges(),a=t.slice(0,be().forum.attribute("numberOfBadgesOnUserCard"));t.length<1||!be().forum.attribute("showBadgesOnUserCard")||e.add("badges",a.map((function(e){return m(V,{badge:e.badge(),onclick:function(){return be().modal.show(M,{badge:e.badge(),userBadgeData:e})}})})))}))}))})(),module.exports=t})();
//# sourceMappingURL=forum.js.map