module.exports=function(t){var e={};function a(r){if(e[r])return e[r].exports;var n=e[r]={i:r,l:!1,exports:{}};return t[r].call(n.exports,n,n.exports,a),n.l=!0,n.exports}return a.m=t,a.c=e,a.d=function(t,e,r){a.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:r})},a.r=function(t){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},a.t=function(t,e){if(1&e&&(t=a(t)),8&e)return t;if(4&e&&"object"==typeof t&&t&&t.__esModule)return t;var r=Object.create(null);if(a.r(r),Object.defineProperty(r,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var n in t)a.d(r,n,function(e){return t[e]}.bind(null,n));return r},a.n=function(t){var e=t&&t.__esModule?function(){return t.default}:function(){return t};return a.d(e,"a",e),e},a.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},a.p="",a(a.s=25)}([function(t,e){t.exports=flarum.core.compat.Model},function(t,e,a){"use strict";a.d(e,"a",(function(){return n}));var r=a(11);function n(t,e){t.prototype=Object.create(e.prototype),t.prototype.constructor=t,r(t,e)}},function(t,e){t.exports=flarum.core.compat["components/Button"]},function(t,e){t.exports=flarum.core.compat["components/Modal"]},function(t,e){t.exports=flarum.core.compat["utils/Stream"]},function(t,e){t.exports=flarum.core.compat["utils/ItemList"]},function(t,e){t.exports=flarum.core.compat["utils/mixin"]},function(t,e,a){"use strict";a.d(e,"a",(function(){return g}));var r=a(1),n=a(3),s=a.n(n),o=a(2),i=a.n(o),d=a(12),u=a.n(d),l=a(5),c=a.n(l),p=(a(17),a(8)),g=function(t){function e(){return t.apply(this,arguments)||this}Object(r.a)(e,t);var a=e.prototype;return a.oninit=function(e){t.prototype.oninit.call(this,e),this.loading=!1},a.className=function(){return"Modal--small"},a.title=function(){return app.translator.trans("v17development-flarum-badges.forum.badge_information")},a.content=function(){var t=this;return m("div",null,m("div",{className:"Modal-body"},this.data().toArray()),this.attrs.userBadgeData&&app.forum.attribute("canGiveBadge")&&m("div",{className:"Modal-footer"},m(i.a,{className:"Button Button--primary",onclick:function(){confirm(app.translator.trans("v17development-flarum-badges.forum.moderation.remove_badge_confirm"))&&(t.loading=!0,t.attrs.userBadgeData.delete().then((function(){return t.hide()})))},loading:this.loading},app.translator.trans("v17development-flarum-badges.forum.moderation.remove_badge"))))},a.data=function(){var t=this,e=new c.a;return e.add("name",m("div",{className:"BadgeModalListItem"},m("p",null,m("b",null,app.translator.trans("v17development-flarum-badges.forum.badge.name"),":")),m("p",null,this.attrs.badge.name()))),e.add("description",m("div",{className:"BadgeModalListItem"},m("p",null,m("b",null,app.translator.trans("v17development-flarum-badges.forum.badge.description"),":")),m("p",null,this.attrs.badge.description()))),this.attrs.userBadgeData&&(this.attrs.userBadgeData.description()||app.forum.attribute("canGiveBadge"))&&e.add("earning_reason",m("div",{className:"BadgeModalListItem"},m("p",null,m("b",null,app.translator.trans("v17development-flarum-badges.forum.badge.earning_reason"),":")),m("p",null,this.attrs.userBadgeData.description()?this.attrs.userBadgeData.description():m("i",null,app.translator.trans("v17development-flarum-badges.forum.badge.no_earning_reason"))),m("p",null,app.forum.attribute("canGiveBadge")&&m("a",{href:"#",onclick:function(e){e.preventDefault(),app.modal.show(p.a,{badge:t.attrs.userBadgeData})}},app.translator.trans("v17development-flarum-badges.forum.badge.update_earning_reason"))))),this.attrs.userBadgeData&&e.add("earned_date",m("div",{className:"BadgeModalListItem"},m("p",null,m("b",null,app.translator.trans("v17development-flarum-badges.forum.badge.earned_on"),":")),m("p",null,u()(this.attrs.userBadgeData.assignedAt())))),this.attrs.userBadgeData&&e.add("category",m("div",{className:"BadgeModalListItem"},m("p",null,m("b",null,app.translator.trans("v17development-flarum-badges.forum.badge.category"),":")),m("p",null,this.attrs.badge.category().name()))),this.attrs.badge&&this.attrs.badge.earnedAmount()&&e.add("earned_amount",m("div",{className:"BadgeModalListItem"},m("p",null,app.translator.transChoice("v17development-flarum-badges.forum.badge.earned_count",this.attrs.badge.earnedAmount(),{count:this.attrs.badge.earnedAmount()})))),e},e}(s.a)},function(t,e,a){"use strict";a.d(e,"a",(function(){return g}));var r=a(1),n=a(3),s=a.n(n),o=a(2),i=a.n(o),d=a(5),u=a.n(d),l=(a(18),a(4)),c=a.n(l),p=a(7),g=function(t){function e(){return t.apply(this,arguments)||this}Object(r.a)(e,t);var a=e.prototype;return a.oninit=function(e){var a=this;t.prototype.oninit.call(this,e),this.selectedBadge=this.attrs.badge?this.attrs.badge.badge():null,this.user=this.attrs.badge?this.attrs.badge.user():this.attrs.user,this.userHasBadge=!1,this.badge=this.attrs.badge?this.attrs.badge:app.store.createRecord("userBadges"),this.description=c()(this.badge.description()),this.availableBadges=[],this.loading=!1,this.attrs.badge?this.availableBadges[this.selectedBadge.id()]=this.selectedBadge.name():(this.loading=!0,app.store.find("badge_categories",{include:"badges"}).then((function(t){a.availableBadges=t,a.loading=!1,m.redraw()})))},a.className=function(){return"Modal--small BadgeModal"},a.title=function(){return app.translator.trans("v17development-flarum-badges.forum."+(this.badge.exists?"update":"give")+"_badge")},a.content=function(){return m("div",null,m("div",{className:"Modal-body"},m("div",{className:"Form"},this.fields().toArray())),m("div",{className:"Modal-footer"},m(i.a,{className:"Button Button--primary",type:"submit",loading:this.loading,disabled:this.userHasBadge},app.translator.trans("core.forum.composer_edit.submit_button"))))},a.fields=function(){var t=this,e=new u.a;return e.add("badge",m("div",{className:"BadgeModalListItem"},m("p",null,m("b",null,app.translator.trans("v17development-flarum-badges.forum.badge.badge"))),m("div",{className:"Select"},m("select",{value:this.selectedBadge?this.selectedBadge.id():"empty",disabled:!!this.attrs.badge,onchange:function(e){"empty"!==e.target.value&&(t.selectedBadge=app.store.getById("badges",e.target.value),t.checkUserHasBadge(t.selectedBadge))},className:"Select-input FormControl"},m("option",{value:"empty"},app.translator.trans("v17development-flarum-badges.forum.select_badge")),!this.attrs.badge&&this.availableBadges.map((function(t){return m("optgroup",{label:t.name()},t.badges().map((function(t){return m("option",{value:t.id()},t.name())})))})),!!this.attrs.badge&&m("option",{value:this.selectedBadge.id()},this.selectedBadge.name())),m("i",{class:"icon fas fa-caret-down Select-caret"})),this.userHasBadge&&m("p",{className:"UserHasBadge"},app.translator.trans("v17development-flarum-badges.forum.user_has_badge"))),30),e.add("badge_description",m("div",{className:"BadgeModalListItem"},m("p",null,m("b",null,app.translator.trans("v17development-flarum-badges.forum.badge.description"),":")),m("p",null,this.selectedBadge?this.selectedBadge.description():app.translator.trans("v17development-flarum-badges.forum.select_badge"))),30),e.add("description",m("div",{className:"BadgeModalListItem"},m("p",null,m("b",null,app.translator.trans("v17development-flarum-badges.forum.badge.earning_reason"))),m("textarea",{className:"FormControl",placeholder:app.translator.trans("v17development-flarum-badges.forum.badge.earning_reason"),bidi:this.description})),30),e},a.checkUserHasBadge=function(t){var e=!1;this.user.userBadges().map((function(a){a.badge()==t&&(e=!0)})),this.userHasBadge=e,m.redraw()},a.onsubmit=function(t){var e=this;t.preventDefault(),this.loading=!0,this.badge.save({description:this.description(),relationships:this.attrs.badge?{}:{badge:this.selectedBadge,user:this.user}}).then((function(){e.attrs.badge?app.modal.show(p.a,{badge:e.attrs.badge.badge(),userBadgeData:e.attrs.badge}):e.hide(),m.redraw()}),(function(t){e.loading=!1,e.handleErrors(t)}))},e}(s.a)},function(t,e){t.exports=flarum.core.compat.Component},function(t,e,a){"use strict";a.d(e,"a",(function(){return d}));var r=a(1),n=a(0),s=a.n(n),o=a(6),i=a.n(o),d=(a(7),function(t){function e(){return t.apply(this,arguments)||this}return Object(r.a)(e,t),e.prototype.apiEndpoint=function(){return"/badges"+(this.exists?"/"+this.data.id:"")},e}(i()(s.a,{name:s.a.attribute("name"),icon:s.a.attribute("icon"),order:s.a.attribute("order"),image:s.a.attribute("image"),description:s.a.attribute("description"),isVisible:s.a.attribute("isVisible"),createdAt:s.a.attribute("createdAt"),earnedAmount:s.a.attribute("earnedAmount"),category:s.a.hasOne("category")})))},function(t,e){function a(e,r){return t.exports=a=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t},t.exports.default=t.exports,t.exports.__esModule=!0,a(e,r)}t.exports=a,t.exports.default=t.exports,t.exports.__esModule=!0},function(t,e){t.exports=flarum.core.compat["helpers/fullTime"]},function(t,e,a){"use strict";a.d(e,"a",(function(){return i}));var r=a(1),n=a(0),s=a.n(n),o=a(6),i=function(t){function e(){return t.apply(this,arguments)||this}return Object(r.a)(e,t),e.prototype.apiEndpoint=function(){return"/badge_categories"+(this.exists?"/"+this.data.id:"")},e}(a.n(o)()(s.a,{name:s.a.attribute("name"),order:s.a.attribute("order"),description:s.a.attribute("description"),isEnabled:s.a.attribute("isEnabled"),createdAt:s.a.attribute("createdAt"),users:s.a.hasMany("users"),badges:s.a.hasMany("badges")}))},,function(t,e){t.exports=flarum.core.compat["components/UserPage"]},function(t,e){t.exports=flarum.core.compat["components/Page"]},function(t,e){t.exports=flarum.core.compat["components/Link"]},function(t,e){t.exports=flarum.core.compat["components/Select"]},function(t,e){t.exports=flarum.core.compat.extend},function(t,e){t.exports=flarum.core.compat["models/User"]},function(t,e){t.exports=flarum.core.compat["utils/UserControls"]},function(t,e){t.exports=flarum.core.compat["components/LinkButton"]},,,function(t,e,a){"use strict";a.r(e);var r=a(19),n=a(0),s=a.n(n),o=a(20),i=a.n(o),d=a(15),u=a.n(d),l=a(21),c=a.n(l),p=a(22),g=a.n(p),f=a(2),b=a.n(f),h=a(10),v=a(13),y=a(1),B=a(6),_=function(t){function e(){return t.apply(this,arguments)||this}return Object(y.a)(e,t),e.prototype.apiEndpoint=function(){return"/user_badges"+(this.exists?"/"+this.data.id:"")},e}(a.n(B)()(s.a,{user:s.a.hasOne("user"),badge:s.a.hasOne("badge"),description:s.a.attribute("description"),isPrimary:s.a.attribute("isPrimary"),assignedAt:s.a.attribute("assignedAt")})),x=a(9),N=a.n(x),M=a(7),O=function(t){function e(){return t.apply(this,arguments)||this}Object(y.a)(e,t);var a=e.prototype;return a.view=function(){var t=this;return this.attrs.badge.isVisible()?m("span",{className:"UserBadge",title:""+(this.attrs.badge.description()?this.attrs.badge.description():""),onclick:function(){return app.modal.show(M.a,{badge:t.attrs.badge,userBadgeData:t.attrs.userBadgeData})}},m("i",{className:this.attrs.badge.icon()})," ",this.attrs.badge.name()):null},a.oncreate=function(e){t.prototype.oncreate.call(this,e),this.$().tooltip()},e}(N.a),j=function(t){function e(){return t.apply(this,arguments)||this}return Object(y.a)(e,t),e.prototype.view=function(){var t={};return this.attrs.user.userBadges().map((function(e){if(!e)return null;var a=e.badge().category();t[a.id()]?t[a.id()].badges.push(e):t[a.id()]={category:a,badges:[e]}})),m("div",{className:"UserBadges"},0===Object.keys(t).length&&m("div",{className:"Placeholder"},m("p",null,"This user does not have any badges yet.")),Object.keys(t).length>=1&&Object.keys(t).sort((function(e,a){return t[e].category.order()-t[a].category.order()})).map((function(e){var a=t[e].category,r=t[e].badges;return a.isEnabled()?m("div",{className:"UserBadgesCategory"},m("h3",null,a.name()),a.description()&&m("p",null,a.description()),r.sort((function(t,e){return t.badge().order()-e.badge().order()})).map((function(t){return m(O,{badge:t.badge(),userBadgeData:t})}))):null})))},e}(N.a),D=function(t){function e(){return t.apply(this,arguments)||this}Object(y.a)(e,t);var a=e.prototype;return a.oninit=function(e){t.prototype.oninit.call(this,e),this.user=null,this.loadUser(m.route.param("username"))},a.content=function(){return j.component({user:this.user})},a.show=function(e){t.prototype.show.call(this,e),this.user=e},e}(u.a),w=a(16),A=a.n(w),P=(A.a,A.a,a(8));app.initializers.add("v17development-flarum-badges",(function(t){t.store.models.badges=h.a,t.store.models.badgeCategories=v.a,t.store.models.userBadges=_,i.a.prototype.userBadges=s.a.hasMany("userBadges"),i.a.prototype.userPrimaryBadge=s.a.hasOne("userPrimaryBadge"),t.routes["user.badges"]={path:"/u/:username/badges",component:D},Object(r.extend)(u.a.prototype,"navItems",(function(e){e.add("badges",g.a.component({href:t.route("user.badges",{username:this.user.username()}),name:"badges",icon:"fas fa-user-tag"},[t.translator.trans("v17development-flarum-badges.forum.badge.badges"),m("span",{className:"Button-badge"},this.user.userBadges().length)]),90)})),Object(r.extend)(c.a,"moderationControls",(function(e,a){t.forum.attribute("canGiveBadge")&&e.add("test",m(b.a,{icon:"fas fa-user-tag",onclick:function(){return t.modal.show(P.a,{user:a})}},t.translator.trans("v17development-flarum-badges.forum.give_badge")))}))}))}]);
//# sourceMappingURL=forum.js.map